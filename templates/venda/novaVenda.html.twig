{% extends "base.html.twig" %}
{% block title %} Nova venda {% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/novaVenda.css') }}">
{% endblock %}
{% block body %}
    <div class="container">
        <header class="d-flex flex-wrap justify-content-center align-items-center py-3">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
                <img class="me-2" src="{{ asset('images/logo-light-mscode.png') }}" width="103">
                <span class="fs-4">pdv</span>
            </a>
            <ul class="nav nav-pills d-flex align-items-center">
                <li class="nav-item"><a href="/" class="nav-link" aria-current="page">In√≠cio</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Vendas</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/vendas-realizadas">Vendas realizadas</a></li>
                        <li><a class="dropdown-item" href="/novaVenda">Nova venda</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Produtos</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/produtos">Estoque</a></li>
                        <li><a class="dropdown-item" href="/categorias">Categorias</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a href="{{ path('app_logout') }}" class="sair m-0 ms-4">Sair</a></li>
            </ul>
        </header>
    </div>

    <main>
        <h2 class="text-white h2 p-2 mb-3">Nova Venda</h2>

        <section>
            <div class="card-area">

            </div>
        </section>

        <section class="formulario">
            <form id="finalizarVendaForm" action="{{ path('finalizarCarrinho', { 'carrinho': carrinho.id }) }}" method="POST">
                <p class="texto">Cliente*</p>
                <div class="formulario-area">

                    <select class="form-select" id="clienteSelect" name="cliente" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                    <button type="submit" class="Finalizar-button"><strong>Finalizar venda</strong></button>
                </div>
            </form>
        </section>

        <section class="tabela">
            <table>
                <thead>
 
                </thead>
                <tbody>
                    {% for produto in carrinho %}
                        <tr class="tabela-conteudo">
                            <td>{{ produto.nome }}</td>
                            <td>{{ produto.categoria.nome }}</td>
                            <td>{{ produto.estoque }}</td>
                            <td class="quantidade">
                                <input class="input-number" type="number" name="quantidade_{{ produto.id }}" value="{{ produto.quantidade }}" min="1">
                            </td>
                            <td>R${{ produto.total }}</td>
                            <td><img class="icone" src="{{ asset('images/lixo.png') }}" alt="Remover"></td> 
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="6">Nenhum produto adicionado ao carrinho.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </main>

    {% block content %}{% endblock %}
    
    <script>
      async function carregarClientes() {
        try {
          const response = await fetch('/clientes', { // Substitua '/clientes' pelo endpoint correto
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
          });

          if (!response.ok) throw new Error('Erro ao carregar clientes');
          const clientes = await response.json();

          const clienteSelect = document.getElementById('clienteSelect');
          clientes.forEach(cliente => {
            const option = document.createElement('option');
            option.value = cliente.id;
            option.textContent = cliente.nome;
            clienteSelect.appendChild(option);
          });
        } catch (error) {
          console.error('Erro ao carregar clientes:', error);
        }
      }

      window.onload = carregarClientes;
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
{% endblock %}